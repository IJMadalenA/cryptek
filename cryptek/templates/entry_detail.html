{% extends 'base.html' %}
{% load static %}
{% load markdown_extras %}

{% block content %}
    <link rel="stylesheet" type="text/css" href="{% static 'styles/post_style.css' %}">
    <style>
        .header-image {
            width: 100%;
            height: auto;
            margin-bottom: 20px;
            border-radius: 24px;
            display: block;
            object-fit: cover;
        }

        h1 {
            font-size: 2em;
            margin-bottom: 15px;
            color: #333;
        }

        .like-dislike-buttons {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .social-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .social-button {
            padding: 10px 15px;
            border: none;
            border-radius: 5px;
            color: white;
            cursor: pointer;
        }

        .X {
            background-color: #000000;
        }

        .linkedin {
            background-color: #0077b5;
        }

        @media (max-width: 768px) {
            .header-image {
                width: 100%;
                height: auto;
                margin-bottom: 15px;
            }

            .card-body {
                padding: 10px;
            }

            h1 {
                font-size: 1.5em;
            }

            .text-muted {
                font-size: 0.8em;
            }

            .card-text {
                font-size: 1em;
            }

            .like-dislike-buttons {
                flex-direction: column;
                gap: 5px;
            }

            .card-body {
                padding: 10px;
                max-width: MIN(50%, 800px);
            }
        }
    </style>

    <div class="container">
        <div class="card mt-3 left top">
            <div class="header-image">
                {% if object.header_image %}
                    <img src="{{ object.header_image.url }}" alt="Header Image" class="header-image">
                {% endif %}
            </div>

            <header>
                <h1 class="page-title">
                    {% block title %}
                        {{ object.title }}
                    {% endblock title %}
                </h1>
                <p class="page-description">

                </p>
            </header>

            <div class="card-subtitle">
                <p class="text-muted">
                    {{ object.author }} | {{ object.created_at | date:"d M Y" }}
                </p>
            </div>

            <div class="like-dislike-buttons">
                {% if user.is_authenticated %}
                    <form id="like-form" method="post" action="{% url 'like_entry' object.slug %}">
                        {% csrf_token %}
                        <input type="hidden" name="type" value="like">
                        <button type="submit" class="btn btn-primary">Like: {{ object.like_count }}</button>
                    </form>
                    <form id="dislike-form" method="post" action="{% url 'like_entry' object.slug %}">
                        {% csrf_token %} <input type="hidden" name="type" value="dislike">
                        <button type="submit" class="btn btn-secondary">Dislike: {{ object.dislike_count }}</button>
                    </form>
                {% else %}
                    <p>Dislikes: {{ object.dislike_count }}</p>
                    <p>Like: {{ object.like_count }}</p>
                {% endif %}
            </div>

            <div class="social-buttons">
                <button class="social-button X" onclick="shareOnX()">Share on X</button>
                <button class="social-button linkedin" onclick="shareOnLinkedIn()">Share on LinkedIn</button>
            </div>

            <div class="card-body">
                <div class="card-text">
                    {{ object.content | safe }}
                </div>
            </div>
        </div>

        <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
        <script>
            function shareOnX() {
                const url = window.location.href;
                const text = document.querySelector('.card-title h1').innerText;
                const message = `Check out this blog post!\n\n${text}\n\nRead more here: ${url}`;
                const shareUrl = `https://x.com/intent/tweet?url=${encodeURIComponent(url)}&text=${encodeURIComponent(message)}`;
                window.open(shareUrl, '_blank');
            }

            function shareOnLinkedIn() {
                const url = window.location.href;
                const title = document.querySelector('.card-title h1').innerText;
                const shareUrl = `https://www.linkedin.com/shareArticle?mini=true&url=${encodeURIComponent(url)}&title=${encodeURIComponent(title)}`;
                window.open(shareUrl, '_blank');
            }
        </script>
    </div>
{% endblock content %}
